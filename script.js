/*! AWWWARDS-LEVEL PORTFOLIO | Mohamed Abdallah Galal */

/* ============================================
   CERTIFICATE DATA
   ============================================ */
const certData = {
    'cert-ecpc': {
        title: 'ICPC ECPC 2024 – Honorable Mention',
        issuer: 'Egyptian Collegiate Programming Contest (ICPC)',
        category: 'competition',
        file: 'assets/Certificates/2025-ECPCQDAYFIVE2024-Mohamed Abdallah Galal-PLACE.pdf',
        type: 'pdf'
    },
    'cert-iti': {
        title: 'Web Development using .NET',
        issuer: 'Information Technology Institute (ITI)',
        category: 'training',
        file: 'assets/images/Certificates/ITI .NET Summer Training.jpg',
        type: 'image'
    },
    'cert-alx-ai': {
        title: 'AI Career Essentials',
        issuer: 'ALX Africa',
        category: 'ai',
        file: 'assets/images/Certificates/66-alx-aice-ai-career-essentials-certificate-mohamed-abdallah.jpg',
        type: 'image'
    },
    'cert-alx-prof': {
        title: 'Professional Foundations',
        issuer: 'ALX Africa',
        category: 'soft-skills',
        file: 'assets/images/Certificates/52-professional-foundations-certificate-mohamed-abdallah-galal-hefnawy.jpg',
        type: 'image'
    },
    'cert-prog-found': {
        title: 'Programming Foundations Level 1',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-programming-foundations-level-1.pdf',
        type: 'pdf'
    },
    'cert-found-2': {
        title: 'Foundations Level 2',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-09-foundations-level-2.pdf',
        type: 'pdf'
    },
    'cert-csharp-1': {
        title: 'C# Level 1',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-14-c-level-1.pdf',
        type: 'pdf'
    },
    'cert-oop': {
        title: 'OOP As It Should Be – Concepts',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-10-oop-as-it-should-be-concepts.pdf',
        type: 'pdf'
    },
    'cert-oop-cs': {
        title: 'OOP As It Should Be in C#',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-16-oop-as-it-should-be-in-c.pdf',
        type: 'pdf'
    },
    'cert-db-1': {
        title: 'Database Level 1 – SQL Concepts & Practice',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-15-database-level-1-sql-concepts-and-practice.pdf',
        type: 'pdf'
    },
    'cert-db-proj': {
        title: 'Database SQL Projects Practice',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-17-database-sql-projects-practice.pdf',
        type: 'pdf'
    },
    'cert-db-2': {
        title: 'Database Level 2 – T-SQL Concepts',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-21-database-level2-concepts-t-sql.pdf',
        type: 'pdf'
    },
    'cert-cs-db': {
        title: 'C# Database Connectivity',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-18-c-database-connectivity.pdf',
        type: 'pdf'
    },
    'cert-algo-1': {
        title: 'Algorithms & Problem Solving Level 1',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-algorithms-problem-solving-level-1.pdf',
        type: 'pdf'
    },
    'cert-algo-2': {
        title: 'Algorithms & Problem Solving Level 2',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-algorithms-problem-solving-level-2.pdf',
        type: 'pdf'
    },
    'cert-cs-intro-1': {
        title: 'Introduction to Programming using C# Level 1',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-introduction-to-programming-using-c-level-1.pdf',
        type: 'pdf'
    },
    'cert-cs-intro-2': {
        title: 'Introduction to Programming using C# Level 2',
        issuer: 'ProgrammingAdvices.com',
        category: 'technical',
        file: 'assets/Certificates/certificate-of-completion-for-introduction-to-programming-using-c-level-2.pdf',
        type: 'pdf'
    },
    'cert-py-intro': {
        title: 'Introduction to Python',
        issuer: 'DataCamp',
        category: 'technical',
        file: 'assets/Certificates/Introduciton to python.pdf',
        type: 'pdf'
    },
    'cert-py-mid': {
        title: 'Intermediate Python',
        issuer: 'DataCamp',
        category: 'technical',
        file: 'assets/Certificates/Intermediate Python.pdf',
        type: 'pdf'
    },
    'cert-cust-svc': {
        title: 'Customer Service Fundamentals',
        issuer: 'IBM / Coursera',
        category: 'soft-skills',
        file: 'assets/Certificates/Customer Service Fundamentals.pdf',
        type: 'pdf'
    },
    'cert-coursera': {
        title: 'Coursera Specializations (5 Certificates)',
        issuer: 'Coursera',
        category: 'training',
        files: [
            { label: 'Certificate 1', file: 'assets/Certificates/Coursera 2FWJ7AUC3YHR.pdf' },
            { label: 'Certificate 2', file: 'assets/Certificates/Coursera P4C9EZBE7CU8.pdf' },
            { label: 'Certificate 3', file: 'assets/Certificates/Coursera T14KQI6BE27D.pdf' },
            { label: 'Certificate 4', file: 'assets/Certificates/Coursera TU0ZA4OESGIE.pdf' },
            { label: 'Certificate 5', file: 'assets/Certificates/Coursera YAO7LADKOYO1.pdf' }
        ],
        type: 'multi'
    }
};

/* ============================================
   CUSTOM CURSOR
   ============================================ */
const cursor = document.getElementById('cursor');
const cursorFollower = document.getElementById('cursorFollower');

if (window.innerWidth > 768) {
    document.addEventListener('mousemove', (e) => {
        cursor.style.transform = `translate(${e.clientX - 4}px, ${e.clientY - 4}px)`;
        cursorFollower.style.transform = `translate(${e.clientX - 16}px, ${e.clientY - 16}px)`;
    });

    // Magnetic effect
    const magneticElements = document.querySelectorAll('[data-magnetic]');
    magneticElements.forEach(el => {
        el.addEventListener('mouseenter', () => {
            cursor.style.transform += ' scale(1.5)';
            cursorFollower.style.transform += ' scale(1.3)';
        });
        el.addEventListener('mouseleave', () => {
            cursor.style.transform = cursor.style.transform.replace(' scale(1.5)', '');
            cursorFollower.style.transform = cursorFollower.style.transform.replace(' scale(1.3)', '');
        });
    });
}

/* ============================================
   NAVIGATION
   ============================================ */
const nav = document.getElementById('nav');
const navToggle = document.getElementById('navToggle');
const navMenu = document.getElementById('navMenu');

window.addEventListener('scroll', () => {
    if (window.scrollY > 60) {
        nav.classList.add('scrolled');
    } else {
        nav.classList.remove('scrolled');
    }
});

navToggle.addEventListener('click', () => {
    navMenu.classList.toggle('open');
    navToggle.classList.toggle('open');
});

// Active nav link
const sections = document.querySelectorAll('section[id]');
const navLinks = document.querySelectorAll('.nav__link');

window.addEventListener('scroll', () => {
    const scrollY = window.scrollY;
    sections.forEach(sec => {
        const top = sec.offsetTop - 120;
        const height = sec.offsetHeight;
        const id = sec.getAttribute('id');
        
        if (scrollY >= top && scrollY < top + height) {
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${id}`) {
                    link.classList.add('active');
                }
            });
        }
    });
});

// Close mobile menu on link click
document.querySelectorAll('.nav__link').forEach(link => {
    link.addEventListener('click', () => {
        navMenu.classList.remove('open');
        navToggle.classList.remove('open');
    });
});

/* ============================================
   HERO PARTICLES
   ============================================ */
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const particles = [];
const particleCount = 50;

class Particle {
    constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 2 + 0.5;
        this.speedX = Math.random() * 0.5 - 0.25;
        this.speedY = Math.random() * 0.5 - 0.25;
        this.opacity = Math.random() * 0.5 + 0.2;
    }

    update() {
        this.x += this.speedX;
        this.y += this.speedY;

        if (this.x > canvas.width) this.x = 0;
        if (this.x < 0) this.x = canvas.width;
        if (this.y > canvas.height) this.y = 0;
        if (this.y < 0) this.y = canvas.height;
    }

    draw() {
        ctx.fillStyle = `rgba(59, 130, 246, ${this.opacity})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
    }
}

function initParticles() {
    for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle());
    }
}

function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    particles.forEach(particle => {
        particle.update();
        particle.draw();
    });

    requestAnimationFrame(animateParticles);
}

initParticles();
animateParticles();

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});

/* ============================================
   TYPING ANIMATION
   ============================================ */
const typingEl = document.getElementById('typing');
const phrases = [
    '.NET Backend Engineer',
    'ASP.NET Core Developer',
    'Clean Architecture Advocate',
    'SOLID Principles Expert',
    'ICPC ECPC 2024 Honorable'
];

let phraseIndex = 0;
let charIndex = 0;
let isDeleting = false;

function type() {
    const currentPhrase = phrases[phraseIndex];
    
    if (!isDeleting) {
        typingEl.textContent = currentPhrase.substring(0, charIndex + 1);
        charIndex++;
        
        if (charIndex === currentPhrase.length) {
            isDeleting = true;
            setTimeout(type, 2000);
            return;
        }
    } else {
        typingEl.textContent = currentPhrase.substring(0, charIndex - 1);
        charIndex--;
        
        if (charIndex === 0) {
            isDeleting = false;
            phraseIndex = (phraseIndex + 1) % phrases.length;
        }
    }
    
    setTimeout(type, isDeleting ? 40 : 100);
}

setTimeout(type, 1000);

/* ============================================
   SCROLL REVEAL
   ============================================ */
const revealElements = document.querySelectorAll('[data-scroll]');

const revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('in-view');
            revealObserver.unobserve(entry.target);
        }
    });
}, {
    threshold: 0.1,
    rootMargin: '0px 0px -80px 0px'
});

revealElements.forEach(el => revealObserver.observe(el));

/* ============================================
   ANIMATED COUNTERS
   ============================================ */
const counters = document.querySelectorAll('[data-count]');

const counterObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const target = entry.target;
            const count = parseInt(target.getAttribute('data-count'));
            let current = 0;
            const increment = count / 60;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= count) {
                    target.textContent = count + '+';
                    clearInterval(timer);
                } else {
                    target.textContent = Math.floor(current) + '+';
                }
            }, 30);
            
            counterObserver.unobserve(target);
        }
    });
}, { threshold: 0.5 });

counters.forEach(counter => counterObserver.observe(counter));

/* ============================================
   3D TILT EFFECT
   ============================================ */
const tiltElements = document.querySelectorAll('[data-tilt]');

tiltElements.forEach(el => {
    el.addEventListener('mousemove', (e) => {
        const rect = el.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        const rotateX = (y - centerY) / 10;
        const rotateY = (centerX - x) / 10;
        
        el.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
    });
    
    el.addEventListener('mouseleave', () => {
        el.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
    });
});

/* ============================================
   SKILLS TABS
   ============================================ */
const skillsTabs = document.querySelectorAll('.skills__tab');
const skillsPanels = document.querySelectorAll('.skills__panel');

skillsTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        const target = tab.getAttribute('data-tab');
        
        skillsTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        skillsPanels.forEach(panel => {
            panel.classList.remove('active');
            if (panel.getAttribute('data-panel') === target) {
                panel.classList.add('active');
            }
        });
    });
});

/* ============================================
   CERTIFICATE FILTERS
   ============================================ */
const certFilters = document.querySelectorAll('.cert-filter');
const certs = document.querySelectorAll('.cert');

certFilters.forEach(filter => {
    filter.addEventListener('click', () => {
        const category = filter.getAttribute('data-filter');
        
        certFilters.forEach(f => f.classList.remove('active'));
        filter.classList.add('active');
        
        certs.forEach((cert, index) => {
            const certCategory = cert.getAttribute('data-category');
            
            if (category === 'all' || certCategory === category) {
                cert.classList.remove('hidden');
                cert.style.animation = 'none';
                setTimeout(() => {
                    cert.style.animation = '';
                }, 10);
            } else {
                cert.classList.add('hidden');
            }
        });
    });
});

/* ============================================
   CERTIFICATE MODAL
   ============================================ */
function openCert(id) {
    const cert = certData[id];
    if (!cert) return;
    
    const modal = document.getElementById('modal');
    const tag = document.getElementById('modalTag');
    const title = document.getElementById('modalTitle');
    const issuer = document.getElementById('modalIssuer');
    const preview = document.getElementById('modalPreview');
    const actions = document.getElementById('modalActions');
    
    // Set category tag
    tag.className = 'modal__tag cert__tag cert__tag--' + cert.category.replace('-', '');
    tag.textContent = cert.category.replace('-', ' ').toUpperCase();
    
    // Set content
    title.textContent = cert.title;
    issuer.textContent = cert.issuer;
    
    // Clear previous content
    preview.innerHTML = '';
    actions.innerHTML = '';
    
    // Handle different certificate types
    if (cert.type === 'image') {
        const img = document.createElement('img');
        img.src = cert.file;
        img.alt = cert.title;
        preview.appendChild(img);
        actions.innerHTML = `<a href="${cert.file}" target="_blank"><i class="fas fa-external-link-alt"></i> Open Certificate</a>`;
        
    } else if (cert.type === 'pdf') {
        preview.innerHTML = `
            <div style="padding: 80px 40px; text-align: center; color: var(--text-muted);">
                <i class="fas fa-file-pdf" style="font-size: 4rem; color: #ef4444; opacity: 0.7; margin-bottom: 16px;"></i>
                <p style="font-size: 1.1rem;">PDF Certificate</p>
                <p style="font-size: 0.9rem; margin-top: 8px;">Click below to view or download</p>
            </div>`;
        actions.innerHTML = `
            <a href="${cert.file}" target="_blank"><i class="fas fa-eye"></i> View PDF</a>
            <a href="${cert.file}" download class="secondary"><i class="fas fa-download"></i> Download</a>`;
        
    } else if (cert.type === 'multi') {
        preview.innerHTML = `
            <div style="padding: 80px 40px; text-align: center; color: var(--text-muted);">
                <i class="fas fa-layer-group" style="font-size: 4rem; color: var(--accent); opacity: 0.7; margin-bottom: 16px;"></i>
                <p style="font-size: 1.1rem;">Multiple Certificates</p>
                <p style="font-size: 0.9rem; margin-top: 8px;">Select a certificate below to view</p>
            </div>`;
        cert.files.forEach(item => {
            actions.innerHTML += `<a href="${item.file}" target="_blank"><i class="fas fa-file-pdf"></i> ${item.label}</a>`;
        });
    }
    
    modal.classList.add('open');
    document.body.style.overflow = 'hidden';
}

function closeCert() {
    const modal = document.getElementById('modal');
    modal.classList.remove('open');
    document.body.style.overflow = '';
}

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeCert();
});

/* ============================================
   CONTACT FORM
   ============================================ */
const contactForm = document.getElementById('contactForm');
const formSuccess = document.getElementById('formSuccess');

if (contactForm) {
    contactForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const subject = document.getElementById('subject').value.trim() || 'Portfolio Inquiry';
        const message = document.getElementById('message').value.trim();
        
        const mailto = `mailto:ma1700641@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(`Hello Mohamed,\n\nMy name is ${name} (${email}).\n\n${message}`)}`;
        
        window.location.href = mailto;
        
        formSuccess.classList.add('show');
        contactForm.reset();
        setTimeout(() => formSuccess.classList.remove('show'), 5000);
    });
}

/* ============================================
   SMOOTH SCROLL
   ============================================ */
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            e.preventDefault();
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });
});

/* ============================================
   BACK TO TOP
   ============================================ */
const toTop = document.getElementById('toTop');

window.addEventListener('scroll', () => {
    if (window.scrollY > 500) {
        toTop.classList.add('visible');
    } else {
        toTop.classList.remove('visible');
    }
});

function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* ============================================
   PARALLAX EFFECT
   ============================================ */
window.addEventListener('scroll', () => {
    const scrolled = window.scrollY;
    const parallaxElements = document.querySelectorAll('.hero__bg');
    
    parallaxElements.forEach(el => {
        el.style.transform = `translateY(${scrolled * 0.5}px)`;
    });
});

/* ============================================
   PAGE LOAD ANIMATION
   ============================================ */
window.addEventListener('load', () => {
    document.body.style.opacity = '0';
    setTimeout(() => {
        document.body.style.transition = 'opacity 0.6s ease';
        document.body.style.opacity = '1';
    }, 100);
});