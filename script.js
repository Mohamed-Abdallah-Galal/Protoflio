/* =============================================
   CERTIFICATE DATA
   ============================================= */
const certData = {
    'cert-ecpc': {
        title: 'ICPC ECPC 2024 – Honorable Mention',
        issuer: 'Egyptian Collegiate Programming Contest (ICPC)',
        category: 'competition',
        categoryLabel: 'Competition',
        file: 'assets/Certificates/2025-ECPCQDAYFIVE2024-Mohamed Abdallah Galal-PLACE.pdf',
        type: 'pdf'
    },
    'cert-iti': {
        title: 'Web Development using .NET',
        issuer: 'Information Technology Institute (ITI)',
        category: 'training',
        categoryLabel: 'Training',
        file: 'assets/images/Certificates/ITI .NET Summer Training.jpg',
        type: 'image'
    },
    'cert-alx-ai': {
        title: 'AI Career Essentials',
        issuer: 'ALX Africa',
        category: 'ai',
        categoryLabel: 'AI',
        file: 'assets/images/Certificates/66-alx-aice-ai-career-essentials-certificate-mohamed-abdallah.jpg',
        type: 'image'
    },
    'cert-alx-prof': {
        title: 'Professional Foundations',
        issuer: 'ALX Africa',
        category: 'soft-skills',
        categoryLabel: 'Soft Skills',
        file: 'assets/images/Certificates/52-professional-foundations-certificate-mohamed-abdallah-galal-hefnawy.jpg',
        type: 'image'
    },
    'cert-prog-found': {
        title: 'Programming Foundations Level 1',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-programming-foundations-level-1.pdf',
        type: 'pdf'
    },
    'cert-found-2': {
        title: 'Foundations Level 2',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-09-foundations-level-2.pdf',
        type: 'pdf'
    },
    'cert-csharp-1': {
        title: 'C# Level 1',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-14-c-level-1.pdf',
        type: 'pdf'
    },
    'cert-oop': {
        title: 'OOP As It Should Be – Concepts',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-10-oop-as-it-should-be-concepts.pdf',
        type: 'pdf'
    },
    'cert-oop-cs': {
        title: 'OOP As It Should Be in C#',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-16-oop-as-it-should-be-in-c.pdf',
        type: 'pdf'
    },
    'cert-db-1': {
        title: 'Database Level 1 – SQL Concepts & Practice',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-15-database-level-1-sql-concepts-and-practice.pdf',
        type: 'pdf'
    },
    'cert-db-proj': {
        title: 'Database SQL Projects Practice',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-17-database-sql-projects-practice.pdf',
        type: 'pdf'
    },
    'cert-db-2': {
        title: 'Database Level 2 – T-SQL Concepts',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-21-database-level2-concepts-t-sql.pdf',
        type: 'pdf'
    },
    'cert-cs-db': {
        title: 'C# Database Connectivity',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-18-c-database-connectivity.pdf',
        type: 'pdf'
    },
    'cert-algo-1': {
        title: 'Algorithms & Problem Solving Level 1',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-algorithms-problem-solving-level-1.pdf',
        type: 'pdf'
    },
    'cert-algo-2': {
        title: 'Algorithms & Problem Solving Level 2',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-algorithms-problem-solving-level-2.pdf',
        type: 'pdf'
    },
    'cert-cs-intro-1': {
        title: 'Introduction to Programming using C# Level 1',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-introduction-to-programming-using-c-level-1.pdf',
        type: 'pdf'
    },
    'cert-cs-intro-2': {
        title: 'Introduction to Programming using C# Level 2',
        issuer: 'Mahara-Tech / ITI',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/certificate-of-completion-for-introduction-to-programming-using-c-level-2.pdf',
        type: 'pdf'
    },
    'cert-py-intro': {
        title: 'Introduction to Python',
        issuer: 'DataCamp',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/Introduciton to python.pdf',
        type: 'pdf'
    },
    'cert-py-mid': {
        title: 'Intermediate Python',
        issuer: 'DataCamp',
        category: 'technical',
        categoryLabel: 'Technical',
        file: 'assets/Certificates/Intermediate Python.pdf',
        type: 'pdf'
    },
    'cert-cust-svc': {
        title: 'Customer Service Fundamentals',
        issuer: 'IBM / Coursera',
        category: 'soft-skills',
        categoryLabel: 'Soft Skills',
        file: 'assets/Certificates/Customer Service Fundamentals.pdf',
        type: 'pdf'
    },
    'cert-coursera': {
        title: 'Coursera Specializations (5 Certificates)',
        issuer: 'Coursera',
        category: 'training',
        categoryLabel: 'Training',
        files: [
            { label: 'Certificate 1 (2FWJ7)', file: 'assets/Certificates/Coursera 2FWJ7AUC3YHR.pdf' },
            { label: 'Certificate 2 (P4C9E)', file: 'assets/Certificates/Coursera P4C9EZBE7CU8.pdf' },
            { label: 'Certificate 3 (T14KQ)', file: 'assets/Certificates/Coursera T14KQI6BE27D.pdf' },
            { label: 'Certificate 4 (TU0ZA)', file: 'assets/Certificates/Coursera TU0ZA4OESGIE.pdf' },
            { label: 'Certificate 5 (YAO7L)', file: 'assets/Certificates/Coursera YAO7LADKOYO1.pdf' }
        ],
        type: 'multi'
    }
};

/* =============================================
   MODAL LOGIC
   ============================================= */
function openModal(id) {
    const cert = certData[id];
    if (!cert) return;

    const overlay = document.getElementById('modalOverlay');
    const catTag = document.getElementById('modalCategory');
    const title = document.getElementById('modalTitle');
    const issuer = document.getElementById('modalIssuer');
    const preview = document.getElementById('modalPreview');
    const actions = document.getElementById('modalActions');

    // Category tag
    catTag.className = 'modal-category-tag ' + cert.category;
    catTag.textContent = cert.categoryLabel;

    // Title & issuer
    title.textContent = cert.title;
    issuer.innerHTML = '<i class="fas fa-building"></i> ' + cert.issuer;

    // Preview & actions
    preview.innerHTML = '';
    actions.innerHTML = '';

    if (cert.type === 'image') {
        const img = document.createElement('img');
        img.src = cert.file;
        img.alt = cert.title;
        img.onerror = function () {
            preview.innerHTML = `
                <div class="modal-preview-placeholder">
                    <i class="fas fa-image"></i>
                    <p>Preview not available. Click below to view.</p>
                </div>`;
        };
        preview.appendChild(img);
        actions.innerHTML = `<a href="${cert.file}" target="_blank"><i class="fas fa-external-link-alt"></i> Open Certificate</a>`;

    } else if (cert.type === 'pdf') {
        preview.innerHTML = `
            <div class="modal-preview-placeholder">
                <i class="fas fa-file-pdf" style="color:#ef4444;opacity:0.7;"></i>
                <p>PDF Certificate – click below to open</p>
            </div>`;
        actions.innerHTML = `
            <a href="${cert.file}" target="_blank"><i class="fas fa-eye"></i> View PDF</a>
            <a href="${cert.file}" download class="secondary"><i class="fas fa-download"></i> Download</a>`;

    } else if (cert.type === 'multi') {
        preview.innerHTML = `
            <div class="modal-preview-placeholder">
                <i class="fas fa-certificates" style="color:var(--accent);opacity:0.7;"></i>
                <p>Multiple certificates — select one below</p>
            </div>`;
        cert.files.forEach(item => {
            actions.innerHTML += `<a href="${item.file}" target="_blank"><i class="fas fa-external-link-alt"></i> ${item.label}</a>`;
        });
    }

    overlay.classList.add('open');
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    const overlay = document.getElementById('modalOverlay');
    overlay.classList.remove('open');
    document.body.style.overflow = '';
}

document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape') closeModal();
});

/* =============================================
   CERTIFICATE FILTER
   ============================================= */
const filterBtns = document.querySelectorAll('.filter-btn');
const certCards = document.querySelectorAll('.cert-card');

filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const filter = btn.dataset.filter;

        certCards.forEach((card, i) => {
            const cat = card.dataset.category;
            const matches = filter === 'all' || cat === filter;
            if (matches) {
                card.classList.remove('hidden');
                card.style.animation = 'none';
                requestAnimationFrame(() => {
                    card.style.animation = '';
                    card.style.animationDelay = (i * 0.04) + 's';
                });
            } else {
                card.classList.add('hidden');
            }
        });
    });
});

/* =============================================
   TYPING ANIMATION
   ============================================= */
const typingLines = [
    '.NET Backend Developer',
    'ASP.NET Core Engineer',
    'Clean Architecture Advocate',
    'SOLID Principles Enthusiast',
    'ICPC ECPC 2024 Honorable'
];

let lineIndex = 0;
let charIndex = 0;
let isDeleting = false;
const typingEl = document.getElementById('typingText');

function typeLoop() {
    if (!typingEl) return;
    const currentLine = typingLines[lineIndex];

    if (!isDeleting) {
        typingEl.textContent = currentLine.substring(0, charIndex + 1);
        charIndex++;
        if (charIndex === currentLine.length) {
            isDeleting = true;
            setTimeout(typeLoop, 2200);
            return;
        }
    } else {
        typingEl.textContent = currentLine.substring(0, charIndex - 1);
        charIndex--;
        if (charIndex === 0) {
            isDeleting = false;
            lineIndex = (lineIndex + 1) % typingLines.length;
        }
    }
    setTimeout(typeLoop, isDeleting ? 45 : 80);
}

window.addEventListener('load', () => {
    setTimeout(typeLoop, 900);
});

/* =============================================
   SCROLL REVEAL
   ============================================= */
const revealEls = document.querySelectorAll('.reveal-up, .reveal-left, .reveal-right');

const revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('revealed');
            revealObserver.unobserve(entry.target);
        }
    });
}, { threshold: 0.12, rootMargin: '0px 0px -60px 0px' });

revealEls.forEach(el => revealObserver.observe(el));

/* =============================================
   NAVBAR
   ============================================= */
const navbar = document.getElementById('navbar');
const navToggle = document.getElementById('navToggle');
const navLinks = document.getElementById('navLinks');

window.addEventListener('scroll', () => {
    if (window.scrollY > 60) {
        navbar.classList.add('scrolled');
    } else {
        navbar.classList.remove('scrolled');
    }
});

navToggle.addEventListener('click', () => {
    navToggle.classList.toggle('open');
    navLinks.classList.toggle('open');
});

// Close nav on link click (mobile)
document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', () => {
        navToggle.classList.remove('open');
        navLinks.classList.remove('open');
    });
});

// Active nav link on scroll
const sections = document.querySelectorAll('section[id]');
window.addEventListener('scroll', () => {
    const scrollY = window.scrollY;
    sections.forEach(sec => {
        const top = sec.offsetTop - 120;
        const height = sec.offsetHeight;
        const id = sec.getAttribute('id');
        const link = document.querySelector(`.nav-link[href="#${id}"]`);
        if (link) {
            if (scrollY >= top && scrollY < top + height) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        }
    });
});

/* =============================================
   SMOOTH SCROLL
   ============================================= */
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            e.preventDefault();
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });
});

/* =============================================
   BACK TO TOP
   ============================================= */
const backToTop = document.getElementById('backToTop');
window.addEventListener('scroll', () => {
    if (window.scrollY > 500) {
        backToTop.classList.add('visible');
    } else {
        backToTop.classList.remove('visible');
    }
});

function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* =============================================
   CONTACT FORM
   ============================================= */
const contactForm = document.getElementById('contactForm');
const formSuccess = document.getElementById('formSuccess');

if (contactForm) {
    contactForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const subject = document.getElementById('subject').value.trim() || 'Portfolio Inquiry';
        const message = document.getElementById('message').value.trim();

        const mailto = `mailto:ma1700641@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(`Hello Mohamed,\n\nMy name is ${name} (${email}).\n\n${message}`)}`;
        window.location.href = mailto;

        formSuccess.classList.add('show');
        contactForm.reset();
        setTimeout(() => formSuccess.classList.remove('show'), 5000);
    });
}

/* =============================================
   CERT CARD ANIMATIONS (stagger on load)
   ============================================= */
const certCardList = document.querySelectorAll('.cert-card');
certCardList.forEach((card, i) => {
    card.style.opacity = '0';
    card.style.transform = 'translateY(24px)';
    card.style.transition = `opacity 0.5s ease ${i * 0.04}s, transform 0.5s ease ${i * 0.04}s`;
});

const certObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const card = entry.target;
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
            certObserver.unobserve(card);
        }
    });
}, { threshold: 0.08, rootMargin: '0px 0px -40px 0px' });

certCardList.forEach(card => certObserver.observe(card));
